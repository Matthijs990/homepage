function get_lang_uri(e){return"en"==e?"":e+"/"}function url_to_array(e){for(var t={},n=e.substring(e.indexOf("?")+1).split("&"),o=0;o<n.length;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}function error(e,t){try{"undefined"==typeof t&&(t=!1),t&&bootbox.alert({size:"small",message:e}),isset(glob.debug)&&glob.debug&&isset(console)&&console.error("Error: "+e)}catch(n){handle_error("error",n)}}function l(e){var t="s100"==glob.s;"undefined"!=typeof glob&&(glob.debug&&"undefined"!=typeof console||t)&&("undefined"==typeof e?console.log(""):console.log(e))}function isset(){var e,t=arguments,n=t.length,o=0;if(0===n)throw new Error("Empty isset");for(;o!==n;){if(t[o]===e||null===t[o])return!1;o++}return!0}function handle_error(e,t,n){try{"undefined"==typeof n&&(n=""),"object"==typeof t&&0!=n.length&&(n+="\n\n"),n+=t.message+"\n\n"+t.stack;var o={error_title:e,error_desc:n,site_id:site_id};glob.debug&&l(o),$.ajax({type:"POST",url:"/_handle_error/",data:o})}catch(i){l(i)}}function time(){return Math.round((new Date).getTime()/1e3)}function _gdrive_auth(e,t){l("_gdrive_auth(immediate, callback)"),"undefined"!=typeof e&&"auto"!=e||(e=!is_gdrive_token_expired()),gapi.auth.authorize({client_id:GOOGLE_CLIENT_ID,scope:gdrive_scopes.join(" "),immediate:e},t)}function is_gdrive_token_expired(){return l("is_gdrive_token_expired()"),!gdrive_auth_result||gdrive_auth_result.expires_at-time()<60}function gdrive_open_picker(e){l("gdrive_open_picker(authResult)"),gdrive_auth_result=e,gdrive_auth_result&&gapi.load("picker",{callback:function(){var e=lang_id;"pt"==e&&(e="pt-PT");var t=(new google.picker.PickerBuilder).addView(new google.picker.DocsView).setAppId(GOOGLE_PROJECT_ID).setOAuthToken(gdrive_auth_result.access_token).setCallback(gdrive_picker_callback).setOrigin(window.location.protocol+"//"+window.location.host).setLocale(e).build();t.setVisible(!0)}})}function gdrive_picker_callback(e){l("gdrive_picker_callback(data)"),e.action==google.picker.Action.PICKED&&gdrive_pass_file_to_uploader(e.docs[0].id)}function gdrive_pass_file_to_uploader(e){gapi.client.load("drive","v2",function(){var t=gapi.client.drive.files.get({fileId:e});t.execute(function(e){or.openRemote("open_remote",e.downloadUrl,{google_access_token:gdrive_auth_result.access_token,original_filename:e.originalFilename,file_extension:e.fileExtension,filesize:e.fileSize})})})}function open_from_drive(){l("open_from_drive()");var e=url_to_array(location.href);if(e.state&&(e=$.parseJSON(e.state.replace("#","")),"open"==e.action)){var t=e.ids[0];_gdrive_auth(!0,function(e){e?(gdrive_auth_result=e,gdrive_pass_file_to_uploader(t)):bootbox.alert({message:$("#confirm_gdrive_auth_modal .msg").html(),size:"small",callback:function(){_gdrive_auth(!1,function(e){e&&(gdrive_auth_result=e,gdrive_pass_file_to_uploader(t))})}})})}}function upload_start(){archive.archive("reset_tree"),open_progress.progressBar("reset"),app.app("option","state","fileIsLoading")}var grive_api_loaded=!1,skydrive_api_loaded=!1,dropbox_api_loaded=!1,magnific_popup_close_markup='<a href="javascript: false;" title="%title%" class="mfp-close-1 mfp-close"><i class="icon9 icon-x"></i></a>';document.addEventListener("DOMContentLoaded",function(){function e(e){return e.match(/:\/\/(.[^\/]+)/)[1].replace("www.","")}function t(e){l.style.display="none",document.removeEventListener("click",t)}function n(){"undefined"!=typeof ga&&ga("send","event","Adblock","Detected","undefined"!=typeof lang_id?lang_id:null),window.ab=!0}function o(){window.ab=!1,"undefined"!=typeof ga&&ga("send","event","Adblock","Not Detected","undefined"!=typeof lang_id?lang_id:null)}var i=document;if(self!=top){var r=e(document.referrer),a=["mp3cut.net","mp3cut.ru","www.mp3cut.ru","stumbleupon.com","surfingbird.com","surfingbird.ru"];a.indexOf(r)==-1&&(top.location=self.location)}var s=i.getElementById("lang_link"),l=i.getElementById("lang_panel");s&&(s.onclick=function(e){e.stopImmediatePropagation(),"none"==l.style.display||""==l.style.display?(l.style.display="block",document.addEventListener("click",t)):t()});var c=i.querySelectorAll("#lang_panel a");c.forEach(function(e,t,n){e.onclick=function(){var e=n[t],o=e.dataset.lang_id;"string"==typeof o&&o.length>=2?document.cookie="lang_id="+o+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/":console.log("Error: Can't get lang_id attr")}}),"undefined"!=typeof blockAdBlock&&(blockAdBlock.on(!0,n),blockAdBlock.on(!1,o))}),function(e){var t=!1;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var n=window.Cookies,o=window.Cookies=e();o.noConflict=function(){return window.Cookies=n,o}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}function t(n){function o(t,i,r){var a;if("undefined"!=typeof document){if(arguments.length>1){if(r=e({path:"/"},o.defaults,r),"number"==typeof r.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*r.expires),r.expires=s}r.expires=r.expires?r.expires.toUTCString():"";try{a=JSON.stringify(i),/^[\{\[]/.test(a)&&(i=a)}catch(l){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var c="";for(var p in r)r[p]&&(c+="; "+p,r[p]!==!0&&(c+="="+r[p]));return document.cookie=t+"="+i+c}t||(a={});for(var _=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,d=0;d<_.length;d++){var f=_[d].split("="),g=f.slice(1).join("=");this.json||'"'!==g.charAt(0)||(g=g.slice(1,-1));try{var h=f[0].replace(u,decodeURIComponent);if(g=n.read?n.read(g,h):n(g,h)||g.replace(u,decodeURIComponent),this.json)try{g=JSON.parse(g)}catch(l){}if(t===h){a=g;break}t||(a[h]=g)}catch(l){}}return a}}return o.set=o,o.get=function(e){return o.call(o,e)},o.getJSON=function(){return o.apply({json:!0},[].slice.call(arguments))},o.defaults={},o.remove=function(t,n){o(t,"",e(n,{expires:-1}))},o.withConverter=t,o}return t(function(){})}),grive_api_loaded=!0;var gdrive_scopes=["https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/drive.readonly"],gdrive_auth_result,s_url;"undefined"!=typeof glob.s_encoder&&glob.s_encoder.length>0&&(s_url=self.location.protocol+"//"+glob.s_encoder),$(document).ready(function(){window.date_page_ready=new Date,"undefined"!=typeof io?(window.socket=io(s_url),window.socket.on("connect",function(){l("Socket connection established on "+s_url),date_socket_connected=new Date}),window.socket.on("disconnect",function(){error("Socket connection lost")})):handle_error("io is undefined")}),$.widget("my.app",{options:{states:["initial","initial urlEnter","fileIsLoading","fileIsLoaded"],state:"initial",class_prefix:"appState_"},_create:function(){},_setOption:function(e,t){"state"==e&&(t=this._state_validate(t),this.options.state!=t&&this._trigger("statechange",event,t)),this._super(e,t)},_setOptions:function(e){this._super(e),this._refresh()},_refresh:function(){var e=this.options.class_prefix+this.options.states.join(" "+this.options.class_prefix);this.element.removeClass(e).addClass(this.options.class_prefix+this.options.state)},_state_validate:function(e){if("undefined"==typeof e)throw"Open_remote.change_state: no state provided";if($.inArray(e,this.options.states)==-1)throw"Open_remote.change_state: "+e+" state not supported";return e}}),$.widget("my.archive",{options:{},_create:function(){this._on({"click #download_all_as_zip_button":function(e){e.preventDefault();var t=$(e.currentTarget).data("href"),n=Ladda.create(e.currentTarget);return n.start(),$.post(t,{},function(e){var t=!0;try{e=$.parseJSON(e),"undefined"!=typeof e.download_url&&(t=!1)}catch(n){}t?error(lang.unable_to_download_file,!0):window.location=api_url+e.download_url}).always(function(){n.stop()}),!1}})},unpack:function(e){var t=this;"undefined"==typeof e.password&&(e.password=""),$.post(api_url+"/unpack/",e,function(n){if("BAD_PASSWORD"==n){var o=bootbox.prompt({title:lang.need_password_4_archive,inputType:"password",size:"small",onEscape:function(){t._cancel()},buttons:{confirm:{label:"OK"},cancel:{label:lang.cancel}},callback:function(n){n?(e.password=n,t.unpack(e)):t._cancel()}});o.bind("shown.bs.modal",function(){o.find(".bootbox-input-password").focus()})}else n=$.parseJSON(n),n.error?t._unpack_error(n):(e.tree_data=n,t._unpack_success(e))})},_build_tree:function(e){var t=this;this.element.find("#jstree").on("select_node.jstree",function(n,o){if(o.node.children.length>0)o.instance.toggle_node(o.node);else{var i=t._get_item_path(o),r=t._download_url(i,e,"download_t");$.get(r).done(function(){var n=t._download_url(i,e);window.location.href=n}).fail(function(){error(lang.unable_to_download_file,!0)})}}).jstree({core:{data:e.tree_data}}),this.element.find(".filename").html(e.archive_filename.replace(/(\.\w+)\.\d+$/,"$1").replace(/\.part\d+(\.\w+)$/,"$1"))},reset_tree:function(){$.jstree.destroy(),this.element.find(".filename").html("")},_cancel:function(){this._trigger("cancel")},_unpack_success:function(e){this._build_tree(e);var t=Cookies.get("uid")?Cookies.get("uid")+"/":"nouid/";this.element.find("#download_all_as_zip_button").data("href",api_url+"/compress/zip/"+t+e.tmp_filename),this._trigger("unpack_success")},_unpack_error:function(e){if("MALWARE_FOUND"==e.error_type)var t="<b>"+lang.danger+"</b><div>"+lang.virus_found.replace("{0}",e.original_filename)+"</div>";else var t=lang.file_not_supported;error(t,1),this._trigger("unpack_error")},_get_item_path:function(e){var t=[];t.push(e.node.text);for(var n=e.node.parents,o=0;o<n.length-1;o++){var i=e.instance.get_node(n[o]);t.push(i.text)}return t.reverse()},_download_url:function(e,t,n){"undefined"==typeof n&&(n="download_d");var o=Cookies.get("uid")?Cookies.get("uid")+"/":"nouid/";return api_url+"/"+n+"/"+o+t.tmp_filename+"/"+encodeURIComponent(e.join("/"))}});var url_params=url_to_array(location.href),is_open_from_grive=!!url_params.state,api_url=self.location.protocol+"//"+glob.s_encoder+"/"+site_id,app,archive,open_progress,or;$(document).ready(function(){is_open_from_grive&&window.socket.on("connect",open_from_drive),app=$("#the_app").app({statechange:function(e,t){"initial"==t&&or.openRemote("option","state","initial")}}),archive=$("#archive").archive({cancel:function(){app.app("option","state","initial")},unpack_success:function(){open_progress.progressBar("success"),app.app("option","state","fileIsLoaded")},unpack_error:function(){open_progress.progressBar("fail"),app.app("option","state","initial")}}),open_progress=$("#open_progress_bar").progressBar({cancel:function(){app.app("option","state","initial"),or.openRemote("cancel_last_process")}}),$("#fileupload").fileupload({singleFileUploads:!1,multipart:!0,url:api_url+"/upload/",formData:{uid:Cookies.get("uid")},start:upload_start,done:function(e,t){var n=!1;try{if(t.files.length>0&&t.result){var o=$.parseJSON(t.result),i=o.files[0];if(o.files.length>1)for(var r=0;r<o.files.length;r++)if(o.files[r].name.match(/\.([a-z]{3}|part01\.[a-z]{3}|\w{1,3}\.001)$/i)){i=o.files[r];break}n=!0,archive.archive("unpack",{tmp_filename:i.tmp_filename,archive_filename:i.name})}}catch(e){n=!1}n||error(lang.error_uploading_file,!0)},fail:function(e,t){open_progress.progressBar("fail")},progress:function(e,t){var n=parseInt(t.loaded/t.total*100,10);open_progress.progressBar("option","value",n)}}),or=$("#open_remote").openRemote({site_id:site_id,statechange:function(e,t){"urlEnter"==t&&app.app("option","state","initial urlEnter")},start:upload_start,progress:function(e,t){open_progress.progressBar("option","value",t.progress_value)},complete:function(e,t){},success:function(e,t){archive.archive("unpack",{tmp_filename:t.files[0].tmp_filename,archive_filename:t.files[0].name})},cancel:function(){app.app("option","state","initial")}}),$("#extract_another_button").click(function(){app.app("option","state","initial")});var e=$("#supported_formats .initial").text().split(", ");$("#supported_formats .initial").html(e.slice(0,15).join(", ")),$("#supported_formats .more_formats").html(e.slice(16).join(", "));var t=lang.and_0_more.replace("{0}",e.slice(16).length);$("#supported_formats a.more_button").html(t),$("#supported_formats a.more_button").click(function(e){$("#supported_formats .more_formats").toggle(),$(this).remove(),e.preventDefault()})}),$.widget("my.progressBar",{options:{value:0},_create:function(){this.bar=this.element.find(".progress-bar"),this.bar.addClass("progress-bar-striped"),this.bar.css("min-width","2em"),this._on({"click button.cancel":function(){this._cancel()}})},reset:function(){this.option("value",0),this.bar.removeClass("progress-bar-success").removeClass("progress-bar-danger"),this._stop_animation()},success:function(){this.bar.addClass("progress-bar-success"),this._stop_animation()},fail:function(){this._stop_animation(),this.bar.removeClass("progress-bar-success").addClass("progress-bar-danger"),this._stop_animation()},_refresh:function(){this.bar.css("width",this.options.value+"%").html(this.options.value+"%")},_cancel:function(){this.reset(),this._trigger("cancel")},_setOption:function(e,t){"value"===e&&(t=this._constrain(t),t>0&&t<100&&this._play_animation()),this._super(e,t)},_setOptions:function(e){this._super(e),this._refresh()},_constrain:function(e){return e>100?e=100:e<0&&(e=0),e},_play_animation:function(){this.bar.hasClass("active")||this.bar.addClass("active")},_stop_animation:function(){this.bar.removeClass("active")}}),$.widget("my.openRemote",{options:{states:["initial","urlEnter"],state:"initial",class_prefix:"openRemoteState_",site_id:null},_create:function(){if(this.element.find(".gdrive").length>0&&this._on({"click .gdrive":function(e){_gdrive_auth("auto",gdrive_open_picker),e.preventDefault()}}),this.element.find(".dropbox").length>0){var e=this;this._on({"click .dropbox":function(t){Dropbox.choose({success:function(t){e.open_remote(t[0].link,{original_filename:t[0].name})},multiselect:!1,linkType:"direct"})}})}this.element.find(".url").length>0&&this._on({"click .url":function(e){this.option("state","urlEnter"),this.element.find(".url_input").focus(),e.preventDefault()},"keypress .url_input":function(e){13==e.which&&(this.element.blur(),this.element.find(".btn.open").focus().click())},"click .or_url_enter_form .open":function(e){var t=this.element.find(".url_input").val();this.open_remote(t),e.preventDefault()},"click .or_url_enter_form .cancel":function(e){this._cancel(),e.preventDefault()}}),this._connect()},_connect:function(){l("_connect()");var e=this;try{socket.on("open_remote2",function(t){if($.isNumeric(t.pid)&&e.option("pid",t.pid),"http_auth_request"==t.message_type&&e._display_auth_prompt(t),"progress"==t.message_type){if(0===e.tmp_i&&e._start(),e.tmp_i++,$.isNumeric(t.progress_value)){var n={progress_value:parseInt(t.progress_value)};e._trigger("progress",event,n)}}else"final_result"==t.message_type?(e._complete(t),t.success?e._success(t):error(lang.open_remote_error,1)):"error"==t.message_type&&(error(lang.open_remote_error,1),e.option("state","initial"),e._trigger("error",event,t))})}catch(t){l(t)}},open_remote:function(e,t){l("open_remote()"),e.length&&("undefined"==typeof t&&(t={}),this.tmp_i=0,this.cancel_last_process(),socket.emit("open_remote2",{remote_url:e,uid:Cookies.get("uid"),site_id:this.options.site_id,params:t}))},_start:function(){l("_start()"),this._trigger("start",null,{})},_complete:function(e){l("_complete()"),this.option("state","initial"),this.upload_info=e,this._trigger("complete",null,e)},_success:function(e){l("_success()"),this._trigger("success",null,e)},_setOption:function(e,t){if("state"==e){var n=this._state_validate(t);this.options.state!=n&&this._trigger("statechange",event,n)}this._super(e,t)},_setOptions:function(e){this._super(e),this._refresh()},_refresh:function(){var e=this.options.class_prefix+this.options.states.join(" "+this.options.class_prefix);this.element.removeClass(e).addClass(this.options.class_prefix+this.options.state)},_state_validate:function(e){if("undefined"==typeof e)throw"Open_remote.change_state: no state provided";if($.inArray(e,this.options.states)==-1)throw"Open_remote.change_state: "+e+" state not supported";return e},_cancel:function(){l("_cancel()"),this.option("state","initial"),this._trigger("cancel")},_display_auth_prompt:function(e){var t=this,n="undefined"!=typeof e.params.username?e.params.username:"",o="undefined"!=typeof e.params.password?e.params.password:"",i=lang.http_auth_message.replace("{0}",e.host?e.host:"");e.realm&&(i+=" "+lang.server_says+": "+e.realm);var r=bootbox.dialog({title:lang.authentication_required+'<div style="font-size: 13px;margin-top: 5px;color: #777;">'+i+"</div>",message:'<div class="form-horizontal"><div class="form-group"><label class="col-md-4 control-label">'+lang.username+':</label><div class="col-md-8">   <input type="text" class="form-control" name="http_auth_username" id="http_auth_username" value="'+n+'" /></div></div><div class="form-group"><label class="col-md-4 control-label">'+lang.password+':</label><div class="col-md-8"><input type="password" class="form-control" name="http_auth_password" id="http_auth_password" value="'+o+'"/></div></div></div>',onEscape:function(){t._cancel()},buttons:{cancel:{label:lang.cancel,callback:function(){t._cancel()}},confirm:{label:lang.log_in,className:"btn-success",callback:function(){var e=$("input[name='http_auth_username']").val(),n=$("input[name='http_auth_password']").val(),o=t.element.find(".url_input").val();t.open_remote(o,{username:e,password:n})}}}});r.bind("shown.bs.modal",function(){r.find("#http_auth_username").focus(function(){$(this).select()}).focus().keypress(function(e){13==e.which&&r.find("#http_auth_password").focus()}),r.find("#http_auth_password").focus(function(){$(this).select()}).keypress(function(e){13==e.which&&(l(1),r.find(".btn-success").click())})})},cancel_last_process:function(){var e=this.option("pid");e>0&&(socket.emit("cancel_convert",{pid:e}),l("Cancel sent to: "+e))}});